"use strict";(self.webpackChunkhuangmh_blog=self.webpackChunkhuangmh_blog||[]).push([[7711],{3234:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"React/setState","title":"\u6df1\u5165\u7406\u89e3 setState","description":"\u6848\u4f8b\u4ee3\u7801","source":"@site/docs/React/setState.mdx","sourceDirName":"React","slug":"/React/setState","permalink":"/docs/React/setState","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"mohan-97","lastUpdatedAt":1706411693000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"React \u6982\u8ff0","permalink":"/docs/React/introduce"},"next":{"title":"\u9ad8\u9636\u7ec4\u4ef6","permalink":"/docs/React/higher-order-components"}}');var r=n(3420),c=n(8906);const a={},i="\u6df1\u5165\u7406\u89e3 setState",l={},d=[{value:"\u6848\u4f8b\u4ee3\u7801",id:"\u6848\u4f8b\u4ee3\u7801",level:2},{value:"setState \u7684\u4f5c\u7528",id:"setstate-\u7684\u4f5c\u7528",level:2},{value:"setState \u53ef\u80fd\u662f\u5f02\u6b65\u66f4\u65b0",id:"setstate-\u53ef\u80fd\u662f\u5f02\u6b65\u66f4\u65b0",level:2},{value:"setState \u4e3a\u4ec0\u4e48\u8981\u8bbe\u8ba1\u6210\u5f02\u6b65?",id:"setstate-\u4e3a\u4ec0\u4e48\u8981\u8bbe\u8ba1\u6210\u5f02\u6b65",level:3},{value:"\u5982\u4f55\u83b7\u53d6\u5230\u66f4\u65b0\u4e4b\u540e\u7684\u503c",id:"\u5982\u4f55\u83b7\u53d6\u5230\u66f4\u65b0\u4e4b\u540e\u7684\u503c",level:3},{value:"setState \u4e00\u5b9a\u662f\u5f02\u6b65\uff1f",id:"setstate-\u4e00\u5b9a\u662f\u5f02\u6b65",level:3},{value:"setState \u7684\u6279\u91cf\u5408\u5e76",id:"setstate-\u7684\u6279\u91cf\u5408\u5e76",level:2},{value:"React 18 \u4e4b\u540e\u7684 setState",id:"react-18-\u4e4b\u540e\u7684-setstate",level:2}];function o(e){const t={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"\u6df1\u5165\u7406\u89e3-setstate",children:"\u6df1\u5165\u7406\u89e3 setState"})}),"\n",(0,r.jsx)(t.h2,{id:"\u6848\u4f8b\u4ee3\u7801",children:"\u6848\u4f8b\u4ee3\u7801"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",children:'class App extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      count: 0,\r\n    };\r\n  }\r\n\r\n  handleClick = () => {\r\n    this.setState({ count: this.state.count + 1 });\r\n  };\r\n\r\n  render(): React.ReactNode {\r\n    return (\r\n      <div>\r\n        {this.state.count}\r\n        <button onClick={this.handleClick} id="btn">\r\n          \u70b9\u51fb\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"setstate-\u7684\u4f5c\u7528",children:"setState \u7684\u4f5c\u7528"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\u66f4\u6539 ",(0,r.jsx)(t.code,{children:"state"})," \u7684\u552f\u4e00\u7684\u65b9\u5f0f \u5c31\u662f\u901a\u8fc7\u8c03\u7528 ",(0,r.jsx)(t.code,{children:"setState"})," \u51fd\u6570\u901a\u77e5 ",(0,r.jsx)(t.code,{children:"React"}),"\u6570\u636e\u5df2\u7ecf\u53d1\u53d1\u751f\u4e86\u53d8\u5316"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"React"})," \u4f1a\u5728\u5408\u9002\u7684\u65f6\u5019\u3002\u89e6\u53d1\u8fd9\u4e2a\u7ec4\u4ef6\u7684\u91cd\u65b0\u6e32\u67d3"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"setstate-\u53ef\u80fd\u662f\u5f02\u6b65\u66f4\u65b0",children:"setState \u53ef\u80fd\u662f\u5f02\u6b65\u66f4\u65b0"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"handleClick = () => {\r\n  this.setState({ count: this.state.count + 1 });\r\n  console.log(this.state.count); // 0;\r\n};\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\u8fd9\u91cc\u5728 ",(0,r.jsx)(t.code,{children:"setState"})," \u8c03\u7528\u5b8c\u6210\u4e4b\u540e\u7acb\u5373\u83b7\u53d6 ",(0,r.jsx)(t.code,{children:"count"})," \u7684\u503c\u7ed3\u679c\u662f 0\u3002"]}),"\n",(0,r.jsxs)(t.li,{children:["\u53ef\u89c1 ",(0,r.jsx)(t.code,{children:"setState"})," \u662f\u5f02\u6b65\u7684\u64cd\u4f5c\uff0c\u6211\u4eec\u5e76\u4e0d\u80fd\u5728\u6267\u884c\u5b8c ",(0,r.jsx)(t.code,{children:"setState"})," \u4e4b\u540e\u7acb\u9a6c\u62ff\u5230\u6700\u65b0\u7684 ",(0,r.jsx)(t.code,{children:"state"})," \u7684\u7ed3\u679c"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"setstate-\u4e3a\u4ec0\u4e48\u8981\u8bbe\u8ba1\u6210\u5f02\u6b65",children:"setState \u4e3a\u4ec0\u4e48\u8981\u8bbe\u8ba1\u6210\u5f02\u6b65?"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"setState"})," \u8bbe\u8ba1\u4e3a\u5f02\u6b65\uff0c\u53ef\u4ee5\u663e\u8457\u7684\u63d0\u5347\u6027\u80fd\uff1b"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"\u5982\u679c\u6bcf\u6b21\u8c03\u7528 setState \u90fd\u8fdb\u884c\u4e00\u6b21\u66f4\u65b0\uff0c\u90a3\u4e48\u610f\u5473\u7740 render \u51fd\u6570\u4f1a\u88ab\u9891\u7e41\u8c03\u7528\uff0c\u754c\u9762\u91cd\u65b0\u6e32\u67d3\uff0c\u8fd9\u6837\u6548\u7387\u662f\u5f88\u4f4e\u7684\uff1b"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"\u5982\u4f55\u83b7\u53d6\u5230\u66f4\u65b0\u4e4b\u540e\u7684\u503c",children:"\u5982\u4f55\u83b7\u53d6\u5230\u66f4\u65b0\u4e4b\u540e\u7684\u503c"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:'handleClick = () => {\r\n  this.setState({ count: this.state.count + 1 }, () => {\r\n    console.log("count: " + this.state.count); // 2\r\n  });\r\n};\n'})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"\u5728\u7c7b\u7ec4\u4ef6\u91cc\u9762\u53ef\u4ee5\u4f7f\u7528 setState \u7684\u7b2c\u4e8c\u53c2\u6570\uff0c\u4e00\u4e2a\u56de\u8c03\u51fd\u6570\uff0c\u8fd9\u4e2a\u56de\u8c03\u51fd\u6570\u4f1a\u5728\u66f4\u65b0\u540e\u4f1a\u6267\u884c\uff1b"}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:'// \u51fd\u6570\u5f0f\u7ec4\u4ef6\r\nuseEffect(() => {\r\n  console.log("count: " + count); // 2\r\n}, [count]);\n'})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"\u5728\u51fd\u6570\u5f0f\u7ec4\u4ef6\u91cc\u9762\u53ef\u4ee5\u4f7f\u7528 useEffect \uff0c\u8fd9\u4e2a\u56de\u8c03\u51fd\u6570\u4f1a\u5728\u6570\u7ec4\u91cc\u9762\u7684\u4f9d\u8d56\u53d8\u5316\u540e\u6267\u884c\uff1b"}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"setstate-\u4e00\u5b9a\u662f\u5f02\u6b65",children:"setState \u4e00\u5b9a\u662f\u5f02\u6b65\uff1f"}),"\n",(0,r.jsx)(t.p,{children:"\u9a8c\u8bc1 1:\u5728 setTimeout \u4e2d\u7684\u66f4\u65b0\uff1a"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:'handleClick = () => {\r\n  setTimeout(() => {\r\n    this.setState({ count: this.state.count + 1 });\r\n    console.log("count: " + this.state.count); // 2\r\n  }, 0);\r\n};\n'})}),"\n",(0,r.jsx)(t.p,{children:"\u9a8c\u8bc1\u4e8c\uff1a\u539f\u751f DOM \u4e8b\u4ef6\uff1a"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"componentDidMount() {\r\n  const btnEl = document.getElementById(\"btn\");\r\n  btnEl.addEventListener('click', () => {\r\n    this.setState({ count: this.state.count + 1 });\r\n    console.log(this.state.count); // 2\r\n  })\r\n}\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\u5728\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u6216 ",(0,r.jsx)(t.code,{children:"React"})," \u5408\u6210\u4e8b\u4ef6\u4e2d\uff0c",(0,r.jsx)(t.code,{children:"setState"})," \u662f\u5f02\u6b65\uff1b"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"Promise"}),"\u3001",(0,r.jsx)(t.code,{children:"setTimeout"})," \u3001",(0,r.jsx)(t.code,{children:"\u539f\u751f\u4e8b\u4ef6\u5904\u7406\uff08native event handlers\uff09"})," \u6216\u4efb\u4f55\u5176\u4ed6\u4e8b\u4ef6\u5185\u90e8\u7684\u66f4\u65b0\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u5728 React \u8fdb\u884c\u5f02\u6b65\u66f4\u65b0"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"setstate-\u7684\u6279\u91cf\u5408\u5e76",children:"setState \u7684\u6279\u91cf\u5408\u5e76"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",children:"handleClick = () => {\r\n  this.setState({ count: this.state.count + 1 });\r\n\r\n  this.setState({ count: this.state.count + 1 });\r\n\r\n  this.setState({ count: this.state.count + 1 });\r\n\r\n  this.setState({ count: this.state.count + 1 });\r\n};\n"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"\u6700\u540e\u7684\u6e32\u67d3\u7ed3\u679c\u662f 1"}),"\n",(0,r.jsxs)(t.li,{children:["\u56e0\u4e3a\u5728\u5408\u6210\u4e8b\u4ef6\u91cc\u9762\u591a\u6b21\u8c03\u7528 ",(0,r.jsx)(t.code,{children:"setState"}),"\u7684\u65f6\u5019\uff0c\u5982\u679c\u6bcf\u6b21\u8c03\u7528 ",(0,r.jsx)(t.code,{children:"setState"})," \u90fd\u8fdb\u884c\u4e00\u6b21\u66f4\u65b0\uff0c\u90a3\u4e48\u610f\u5473\u7740 ",(0,r.jsx)(t.code,{children:"render"})," \u51fd\u6570\u4f1a\u88ab\u9891\u7e41\u8c03\u7528\uff0c\u754c\u9762\u91cd\u65b0\u6e32\u67d3\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u6548\u7387\u5f88\u4f4e"]}),"\n",(0,r.jsxs)(t.li,{children:["\u6700\u597d\u662f\u5c06\u6bcf\u6b21\u7684 ",(0,r.jsx)(t.code,{children:"setState"})," \u653e\u5165\u5230\u4e00\u4e2a\u4efb\u52a1\u961f\u5217\u4e2d(\u6570\u7ec4)\uff0cReact \u4f1a\u5c06\u4efb\u52a1\u961f\u5217\u91cc\u9762\u7684\u72b6\u6001\u4f9d\u6b21\u5408\u5e76\u3002\u62ff\u5408\u5e76\u5b8c\u6210\u7684 state \u505a\u4e00\u6b21 render"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"\u5982\u4f55\u53ef\u4ee5\u505a\u5230\uff0c\u8ba9 count \u6700\u7ec8\u53d8\u6210 4 \u5462\uff1f"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-jsx",children:"handleClick = () => {\r\n  this.setState((prevState) => {\r\n    return {\r\n      count: prevState.count + 1,\r\n    };\r\n  });\r\n\r\n  this.setState((prevState) => {\r\n    return {\r\n      count: prevState.count + 1,\r\n    };\r\n  });\r\n\r\n  this.setState((prevState) => {\r\n    return {\r\n      count: prevState.count + 1,\r\n    };\r\n  });\r\n\r\n  this.setState((prevState) => {\r\n    return {\r\n      count: prevState.count + 1,\r\n    };\r\n  });\r\n};\n"})}),"\n",(0,r.jsx)(t.h2,{id:"react-18-\u4e4b\u540e\u7684-setstate",children:"React 18 \u4e4b\u540e\u7684 setState"}),"\n",(0,r.jsx)(t.admonition,{type:"success",children:(0,r.jsxs)(t.p,{children:["\u4ece\u5e26\u6709 ",(0,r.jsx)(t.code,{children:"createRoot"})," \u7684 React 18 \u5f00\u59cb\uff0c\u6240\u6709\u66f4\u65b0\u90fd\u5c06\u81ea\u52a8\u6279\u5904\u7406\uff0c\u65e0\u8bba\u5b83\u4eec\u6765\u81ea\u4f55\u5904\u3002\u4e5f\u5c31\u662f\u8bf4 ",(0,r.jsx)(t.code,{children:"Promise"}),"\u3001",(0,r.jsx)(t.code,{children:"setTimeout"})," \u3001",(0,r.jsx)(t.code,{children:"\u539f\u751f\u4e8b\u4ef6\u5904\u7406\uff08native event handlers\uff09"})," \u6216\u8005\u5176\u4ed6\u7684\u4efb\u4f55\u4e8b\u4ef6\r\n\u5c06\u548c React \u4e8b\u4ef6\u5185\u90e8\u66f4\u65b0\u76f8\u540c\u7684\u65b9\u5f0f\u8fdb\u884c\u6279\u91cf\u5904\u7406\u6216\u8005\u5f02\u6b65\u66f4\u65b0"]})})]})}function h(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8906:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>i});var s=n(6672);const r={},c=s.createContext(r);function a(e){const t=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(c.Provider,{value:t},e.children)}}}]);