"use strict";(self.webpackChunkhuangmh_blog=self.webpackChunkhuangmh_blog||[]).push([[9651],{3881:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var r=t(8101);const s={},c=r.createContext(s);function o(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(c.Provider,{value:n},e.children)}},5254:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"Redux/combineReducers","title":"combineReducers","description":"combineReducers (\u7b80\u4ecb)","source":"@site/docs/Redux/combineReducers.mdx","sourceDirName":"Redux","slug":"/Redux/combineReducers","permalink":"/docs/Redux/combineReducers","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"mohan-97","lastUpdatedAt":1699170405000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"compose","permalink":"/docs/Redux/compose"},"next":{"title":"bindActionCreators","permalink":"/docs/Redux/bindActionCreators"}}');var s=t(5105),c=t(3881);const o={},i="combineReducers",d={},u=[{value:"combineReducers (\u7b80\u4ecb)",id:"combinereducers-\u7b80\u4ecb",level:2},{value:"\u5904\u7406\u591a\u4e2a\u72ec\u7acb\u7684 reducer \u51fd\u6570\u6587\u4ef6",id:"\u5904\u7406\u591a\u4e2a\u72ec\u7acb\u7684-reducer-\u51fd\u6570\u6587\u4ef6",level:2},{value:"combineReducers \u7684\u4f7f\u7528",id:"combinereducers-\u7684\u4f7f\u7528",level:2},{value:"combineReducers \u6e90\u7801 \u89e3\u6790",id:"combinereducers-\u6e90\u7801-\u89e3\u6790",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"combinereducers",children:"combineReducers"})}),"\n",(0,s.jsx)(n.h2,{id:"combinereducers-\u7b80\u4ecb",children:"combineReducers (\u7b80\u4ecb)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5f53\u6211\u4eec\u5e94\u7528\u8f83\u5927\u7684\u65f6\u5019\u9700\u8981\u5c06 reducer \u62c6\u6210\u591a\u4e2a\u51fd\u6570 \u8fd9\u6837\u53ef\u4ee5\u8ba9\u6bcf\u4e2a reducer \u8d1f\u8d23\u72ec\u7acb\u7ba1\u7406 state \u4e2d\u7684\u4e00\u90e8\u5206"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"combineReducers"})," \u7684\u4f5c\u7528\u662f\u628a\u591a\u4e2a\u62c6\u5206\u51fa\u6765\u7684 reducer \u51fd\u6570\u5408\u5e76\u6210\u4e00\u4e2a\u6700\u7ec8\u7684 reducer \u51fd\u6570\u4f9b createStore \u4f7f\u7528\u3002"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u5904\u7406\u591a\u4e2a\u72ec\u7acb\u7684-reducer-\u51fd\u6570\u6587\u4ef6",children:"\u5904\u7406\u591a\u4e2a\u72ec\u7acb\u7684 reducer \u51fd\u6570\u6587\u4ef6"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5982\u679c\u6211\u4eec\u6709\u4e24\u4e2a\u72ec\u7acb\u7684 reducer \u51fd\u6570\u6587\u4ef6 \u4f46\u662f ",(0,s.jsx)(n.code,{children:"createStore"})," \u51fd\u6570\u53ea\u63a5\u53d7\u4e00\u4e2a\u6839 Reducer \u51fd\u6570"]}),"\n",(0,s.jsx)(n.li,{children:"\u7531\u4e8e reducer \u662f\u666e\u901a\u7684 JS \u51fd\u6570\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c06 reducer \u7684\u6587\u4ef6 \u5bfc\u5165\u56de reducer.js\uff0c\u5e76\u7f16\u5199\u4e00\u4e2a\u65b0\u7684\u6839 reducer\uff0c\u5176\u552f\u4e00\u7684\u5de5\u4f5c\u5c31\u662f\u8c03\u7528\u5176\u4ed6\u4e24\u4e2a\u51fd\u6570\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:"title='./reducer.ts'",children:'import todosReducer from "./features/todos/todosSlice";\nimport filtersReducer from "./features/filters/filtersSlice";\n\nexport default function rootReducer(state = {}, action) {\n  // always return a new object for the root state\n  return {\n    // the value of `state.todos` is whatever the todos reducer returns\n    todos: todosReducer(state.todos, action),\n    // For both reducers, we only pass in their slice of the state\n    filters: filtersReducer(state.filters, action),\n  };\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"combinereducers-\u7684\u4f7f\u7528",children:"combineReducers \u7684\u4f7f\u7528"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Redux"}),"\u6838\u5fc3\u5305\u91cc\u9762\u63d0\u4f9b\u4e86\u8fd9\u4e2a\u5de5\u5177\u51fd\u6570 \u540d\u5b57\u53eb ",(0,s.jsx)(n.code,{children:"combineReducers"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"combineReducers"})," \u63a5\u53d7\u4e00\u4e2a\u5bf9\u8c61 \u5bf9\u8c61\u7684 ",(0,s.jsx)(n.code,{children:"key"})," \u5c06\u4f1a\u6210\u4e3a redux \u91cc\u9762\u72b6\u6001\u7684 key \u7136\u540e\u4ed6\u7684\u503c\u662f\u4e00\u4e2a reducer \u51fd\u6570"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:"title='./reducer.ts'",children:'import { combineReducers } from "redux";\n\nimport todosReducer from "./features/todos/todosSlice";\nimport filtersReducer from "./features/filters/filtersSlice";\n\nconst rootReducer = combineReducers({\n  // Define a top-level state field named `todos`, handled by `todosReducer`\n  todos: todosReducer,\n  filters: filtersReducer,\n});\n\nexport default rootReducer;\n'})}),"\n",(0,s.jsx)(n.h2,{id:"combinereducers-\u6e90\u7801-\u89e3\u6790",children:"combineReducers \u6e90\u7801 \u89e3\u6790"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",metastring:"title='./combineReducers.ts'",children:'import { Action } from "./types/actions";\nimport { Reducer, StateFromReducersMapObject } from "./types/reducer";\nimport ActionTypes from "./utils/actionTypes";\nimport isPlainObject from "./utils/isPlainObject";\nimport { kindOf } from "./utils/kindof";\n\nfunction getUnexpectedStateShapeWarningMessage(\n  inputState: object,\n  reducers: { [key: string]: Reducer<any, any, any> },\n  action: Action\n) {\n  if (action && action.type === ActionTypes.REPLACE) return;\n\n  const reducerKeys = Object.keys(reducers);\n  const argumentName =\n    action && action.type === ActionTypes.INIT\n      ? "preloadedState argument passed to createStore"\n      : "previous state received by the reducer";\n\n  if (reducerKeys.length === 0) {\n    return (\n      "Store does not have a valid reducer. Make sure the argument passed " +\n      "to combineReducers is an object whose values are reducers."\n    );\n  }\n\n  if (!isPlainObject(inputState)) {\n    return (\n      `The ${argumentName} has unexpected type of "${kindOf(\n        inputState\n      )}". Expected argument to be an object with the following ` +\n      `keys: "${reducerKeys.join(\'", "\')}"`\n    );\n  }\n\n  const unexpectedKeys = Object.keys(inputState).filter(\n    (key) => !reducers.hasOwnProperty(key)\n  );\n\n  if (unexpectedKeys.length > 0) {\n    return (\n      `Unexpected ${unexpectedKeys.length > 1 ? "keys" : "key"} ` +\n      `"${unexpectedKeys.join(\'", "\')}" found in ${argumentName}. ` +\n      `Expected to find one of the known reducer keys instead: ` +\n      `"${reducerKeys.join(\'", "\')}". Unexpected keys will be ignored.`\n    );\n  }\n}\n\nfunction assertReducerShape(reducers: {\n  [key: string]: Reducer<any, any, any>;\n}) {\n  Object.keys(reducers).forEach((key) => {\n    const reducer = reducers[key];\n    const initialState = reducer(undefined, { type: ActionTypes.INIT });\n\n    if (typeof initialState === "undefined") {\n      throw new Error(\n        `The slice reducer for key "${key}" returned undefined during initialization. ` +\n          `If the state passed to the reducer is undefined, you must ` +\n          `explicitly return the initial state. The initial state may ` +\n          `not be undefined. If you don\'t want to set a value for this reducer, ` +\n          `you can use null instead of undefined.`\n      );\n    }\n\n    if (\n      typeof reducer(undefined, {\n        type: ActionTypes.PROBE_UNKNOWN_ACTION(),\n      }) === "undefined"\n    ) {\n      throw new Error(\n        `The slice reducer for key "${key}" returned undefined when probed with a random type. ` +\n          `Don\'t try to handle \'${ActionTypes.INIT}\' or other actions in "redux/*" ` +\n          `namespace. They are considered private. Instead, you must return the ` +\n          `current state for any unknown actions, unless it is undefined, ` +\n          `in which case you must return the initial state, regardless of the ` +\n          `action type. The initial state may not be undefined, but can be null.`\n      );\n    }\n  });\n}\n\nconst combineReducers = (reducers: {\n  [key: string]: Reducer<any, any, any>;\n}) => {\n  /**\n   * \u8fc7\u6ee4\u6389undefined\u7c7b\u578bkey\u7684reducer\n   * \u53ea\u4fdd\u7559reduces\u7684\u503c\u53ea\u7b49\u4e8efunction\u7684\u6570\u636e\n   */\n  const reducerKeys = Object.keys(reducers);\n\n  const finalReducers: { [key: string]: Reducer<any, any, any> } = {};\n\n  for (let i = 0; i < reducerKeys.length; i++) {\n    const key = reducerKeys[i];\n\n    if (process.env.NODE_ENV !== "production") {\n      if (typeof reducers[key] === "undefined") {\n        console.log(`No reducer provided for key "${key}"`);\n      }\n    }\n\n    if (typeof reducers[key] === "function") {\n      finalReducers[key] = reducers[key];\n    }\n  }\n\n  const finalReducerKeys = Object.keys(finalReducers);\n\n  /**\n   * \u6821\u9a8c\u6bcf\u4e2areducer\u8fd4\u56de\u503c\u662f\u5426\u90fd\u6709\u6548\n   * \u4e0d\u8981\u5904\u7406redux\u5185\u90e8\u7684 Action \u7c7b\u578b\n   */\n  let shapeAssertionError: unknown;\n  try {\n    assertReducerShape(finalReducers);\n  } catch (e) {\n    shapeAssertionError = e;\n  }\n\n  return function combination(\n    state: StateFromReducersMapObject<typeof reducers>,\n    action: Action\n  ) {\n    /**\n     * \u5982\u679cshapeAssertionError\u6709\u9519\u8bef\u4fe1\u606f \u76f4\u63a5\u629b\u51fa\u5f02\u5e38\n     */\n    if (shapeAssertionError) {\n      throw shapeAssertionError;\n    }\n\n    /**\n     * \u5224\u65adreduce\u91cc\u9762\u7684Key\u548cState\u91cc\u9762\u7684Key\u662f\u5426\u76f8\u540c\n     * \u4e0d\u76f8\u540c\u5219\u629b\u51fa\u5f02\u5e38\n     */\n    if (process.env.NODE_ENV !== "production") {\n      const warningMessage = getUnexpectedStateShapeWarningMessage(\n        state,\n        finalReducers,\n        action\n      );\n      if (warningMessage) {\n        console.warn(warningMessage);\n      }\n    }\n\n    /**\n     * \u4f9d\u6b21\u6267\u884c\u5bf9\u8c61\u91cc\u9762\u6bcf\u4e2areduce\u51fd\u6570\n     * \u5982\u679c reduce \u51fd\u6570\u8fd4\u56de\u503c\u662f \'undefined\' \u629b\u51fa\u9519\u8bef\n     * \u628a\u6bcf\u4e2areduce\u6267\u884c\u7684\u7ed3\u679c\u653e\u5230\u4e00\u4e2a\u65b0\u5bf9\u8c61\u91cc\u9762 \u548c\u4e0a\u4e00\u4e2a\u7ed3\u679c\u8fdb\u884c\u6bd4\u8f83 \u5224\u8bfb\u662f\u5426\u4fee\u6539\u8fc7\n     * \u5982\u679c\u4fee\u6539\u8fc7\u8fd4\u56de\u65b0\u5bf9\u8c61 \u6ca1\u6709\u4fee\u6539\u8fd4\u56de\u4e0a\u4e00\u6b21\u7684\u5bf9\u8c61\n     */\n    let hasChanged = false;\n    const nextState: StateFromReducersMapObject<typeof reducers> = {};\n    for (let i = 0; i < finalReducerKeys.length; i++) {\n      const key = finalReducerKeys[i];\n      const reducer = finalReducers[key];\n      const previousStateForKey = state[key];\n      const nextStateForKey = reducer(previousStateForKey, action);\n      if (typeof nextStateForKey === "undefined") {\n        const actionType = action && action.type;\n        throw new Error(\n          `When called with an action of type ${\n            actionType ? `"${String(actionType)}"` : "(unknown type)"\n          }, the slice reducer for key "${key}" returned undefined. ` +\n            `To ignore an action, you must explicitly return the previous state. ` +\n            `If you want this reducer to hold no value, you can return null instead of undefined.`\n        );\n      }\n      nextState[key] = nextStateForKey;\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey;\n    }\n    hasChanged =\n      hasChanged || finalReducerKeys.length !== Object.keys(state).length;\n    return hasChanged ? nextState : state;\n  };\n};\n\nexport default combineReducers;\n'})})]})}function l(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);