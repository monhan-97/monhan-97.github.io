"use strict";(self.webpackChunkhuangmh_blog=self.webpackChunkhuangmh_blog||[]).push([[9651],{6608:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"Redux/combineReducers","title":"combineReducers","description":"combineReducers (\u7b80\u4ecb)","source":"@site/docs/Redux/combineReducers.mdx","sourceDirName":"Redux","slug":"/Redux/combineReducers","permalink":"/docs/Redux/combineReducers","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"mohan-97","lastUpdatedAt":1699170405000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"compose","permalink":"/docs/Redux/compose"},"next":{"title":"bindActionCreators","permalink":"/docs/Redux/bindActionCreators"}}');var s=n(3420),c=n(8906);const o={},i="combineReducers",d={},u=[{value:"combineReducers (\u7b80\u4ecb)",id:"combinereducers-\u7b80\u4ecb",level:2},{value:"\u5904\u7406\u591a\u4e2a\u72ec\u7acb\u7684 reducer \u51fd\u6570\u6587\u4ef6",id:"\u5904\u7406\u591a\u4e2a\u72ec\u7acb\u7684-reducer-\u51fd\u6570\u6587\u4ef6",level:2},{value:"combineReducers \u7684\u4f7f\u7528",id:"combinereducers-\u7684\u4f7f\u7528",level:2},{value:"combineReducers \u6e90\u7801 \u89e3\u6790",id:"combinereducers-\u6e90\u7801-\u89e3\u6790",level:2}];function a(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"combinereducers",children:"combineReducers"})}),"\n",(0,s.jsx)(r.h2,{id:"combinereducers-\u7b80\u4ecb",children:"combineReducers (\u7b80\u4ecb)"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u5f53\u6211\u4eec\u5e94\u7528\u8f83\u5927\u7684\u65f6\u5019\u9700\u8981\u5c06 reducer \u62c6\u6210\u591a\u4e2a\u51fd\u6570 \u8fd9\u6837\u53ef\u4ee5\u8ba9\u6bcf\u4e2a reducer \u8d1f\u8d23\u72ec\u7acb\u7ba1\u7406 state \u4e2d\u7684\u4e00\u90e8\u5206"}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"combineReducers"})," \u7684\u4f5c\u7528\u662f\u628a\u591a\u4e2a\u62c6\u5206\u51fa\u6765\u7684 reducer \u51fd\u6570\u5408\u5e76\u6210\u4e00\u4e2a\u6700\u7ec8\u7684 reducer \u51fd\u6570\u4f9b createStore \u4f7f\u7528\u3002"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"\u5904\u7406\u591a\u4e2a\u72ec\u7acb\u7684-reducer-\u51fd\u6570\u6587\u4ef6",children:"\u5904\u7406\u591a\u4e2a\u72ec\u7acb\u7684 reducer \u51fd\u6570\u6587\u4ef6"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["\u5982\u679c\u6211\u4eec\u6709\u4e24\u4e2a\u72ec\u7acb\u7684 reducer \u51fd\u6570\u6587\u4ef6 \u4f46\u662f ",(0,s.jsx)(r.code,{children:"createStore"})," \u51fd\u6570\u53ea\u63a5\u53d7\u4e00\u4e2a\u6839 Reducer \u51fd\u6570"]}),"\n",(0,s.jsx)(r.li,{children:"\u7531\u4e8e reducer \u662f\u666e\u901a\u7684 JS \u51fd\u6570\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u5c06 reducer \u7684\u6587\u4ef6 \u5bfc\u5165\u56de reducer.js\uff0c\u5e76\u7f16\u5199\u4e00\u4e2a\u65b0\u7684\u6839 reducer\uff0c\u5176\u552f\u4e00\u7684\u5de5\u4f5c\u5c31\u662f\u8c03\u7528\u5176\u4ed6\u4e24\u4e2a\u51fd\u6570\u3002"}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",metastring:"title='./reducer.ts'",children:'import todosReducer from "./features/todos/todosSlice";\r\nimport filtersReducer from "./features/filters/filtersSlice";\r\n\r\nexport default function rootReducer(state = {}, action) {\r\n  // always return a new object for the root state\r\n  return {\r\n    // the value of `state.todos` is whatever the todos reducer returns\r\n    todos: todosReducer(state.todos, action),\r\n    // For both reducers, we only pass in their slice of the state\r\n    filters: filtersReducer(state.filters, action),\r\n  };\r\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"combinereducers-\u7684\u4f7f\u7528",children:"combineReducers \u7684\u4f7f\u7528"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"Redux"}),"\u6838\u5fc3\u5305\u91cc\u9762\u63d0\u4f9b\u4e86\u8fd9\u4e2a\u5de5\u5177\u51fd\u6570 \u540d\u5b57\u53eb ",(0,s.jsx)(r.code,{children:"combineReducers"})]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"combineReducers"})," \u63a5\u53d7\u4e00\u4e2a\u5bf9\u8c61 \u5bf9\u8c61\u7684 ",(0,s.jsx)(r.code,{children:"key"})," \u5c06\u4f1a\u6210\u4e3a redux \u91cc\u9762\u72b6\u6001\u7684 key \u7136\u540e\u4ed6\u7684\u503c\u662f\u4e00\u4e2a reducer \u51fd\u6570"]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",metastring:"title='./reducer.ts'",children:'import { combineReducers } from "redux";\r\n\r\nimport todosReducer from "./features/todos/todosSlice";\r\nimport filtersReducer from "./features/filters/filtersSlice";\r\n\r\nconst rootReducer = combineReducers({\r\n  // Define a top-level state field named `todos`, handled by `todosReducer`\r\n  todos: todosReducer,\r\n  filters: filtersReducer,\r\n});\r\n\r\nexport default rootReducer;\n'})}),"\n",(0,s.jsx)(r.h2,{id:"combinereducers-\u6e90\u7801-\u89e3\u6790",children:"combineReducers \u6e90\u7801 \u89e3\u6790"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",metastring:"title='./combineReducers.ts'",children:'import { Action } from "./types/actions";\r\nimport { Reducer, StateFromReducersMapObject } from "./types/reducer";\r\nimport ActionTypes from "./utils/actionTypes";\r\nimport isPlainObject from "./utils/isPlainObject";\r\nimport { kindOf } from "./utils/kindof";\r\n\r\nfunction getUnexpectedStateShapeWarningMessage(\r\n  inputState: object,\r\n  reducers: { [key: string]: Reducer<any, any, any> },\r\n  action: Action\r\n) {\r\n  if (action && action.type === ActionTypes.REPLACE) return;\r\n\r\n  const reducerKeys = Object.keys(reducers);\r\n  const argumentName =\r\n    action && action.type === ActionTypes.INIT\r\n      ? "preloadedState argument passed to createStore"\r\n      : "previous state received by the reducer";\r\n\r\n  if (reducerKeys.length === 0) {\r\n    return (\r\n      "Store does not have a valid reducer. Make sure the argument passed " +\r\n      "to combineReducers is an object whose values are reducers."\r\n    );\r\n  }\r\n\r\n  if (!isPlainObject(inputState)) {\r\n    return (\r\n      `The ${argumentName} has unexpected type of "${kindOf(\r\n        inputState\r\n      )}". Expected argument to be an object with the following ` +\r\n      `keys: "${reducerKeys.join(\'", "\')}"`\r\n    );\r\n  }\r\n\r\n  const unexpectedKeys = Object.keys(inputState).filter(\r\n    (key) => !reducers.hasOwnProperty(key)\r\n  );\r\n\r\n  if (unexpectedKeys.length > 0) {\r\n    return (\r\n      `Unexpected ${unexpectedKeys.length > 1 ? "keys" : "key"} ` +\r\n      `"${unexpectedKeys.join(\'", "\')}" found in ${argumentName}. ` +\r\n      `Expected to find one of the known reducer keys instead: ` +\r\n      `"${reducerKeys.join(\'", "\')}". Unexpected keys will be ignored.`\r\n    );\r\n  }\r\n}\r\n\r\nfunction assertReducerShape(reducers: {\r\n  [key: string]: Reducer<any, any, any>;\r\n}) {\r\n  Object.keys(reducers).forEach((key) => {\r\n    const reducer = reducers[key];\r\n    const initialState = reducer(undefined, { type: ActionTypes.INIT });\r\n\r\n    if (typeof initialState === "undefined") {\r\n      throw new Error(\r\n        `The slice reducer for key "${key}" returned undefined during initialization. ` +\r\n          `If the state passed to the reducer is undefined, you must ` +\r\n          `explicitly return the initial state. The initial state may ` +\r\n          `not be undefined. If you don\'t want to set a value for this reducer, ` +\r\n          `you can use null instead of undefined.`\r\n      );\r\n    }\r\n\r\n    if (\r\n      typeof reducer(undefined, {\r\n        type: ActionTypes.PROBE_UNKNOWN_ACTION(),\r\n      }) === "undefined"\r\n    ) {\r\n      throw new Error(\r\n        `The slice reducer for key "${key}" returned undefined when probed with a random type. ` +\r\n          `Don\'t try to handle \'${ActionTypes.INIT}\' or other actions in "redux/*" ` +\r\n          `namespace. They are considered private. Instead, you must return the ` +\r\n          `current state for any unknown actions, unless it is undefined, ` +\r\n          `in which case you must return the initial state, regardless of the ` +\r\n          `action type. The initial state may not be undefined, but can be null.`\r\n      );\r\n    }\r\n  });\r\n}\r\n\r\nconst combineReducers = (reducers: {\r\n  [key: string]: Reducer<any, any, any>;\r\n}) => {\r\n  /**\r\n   * \u8fc7\u6ee4\u6389undefined\u7c7b\u578bkey\u7684reducer\r\n   * \u53ea\u4fdd\u7559reduces\u7684\u503c\u53ea\u7b49\u4e8efunction\u7684\u6570\u636e\r\n   */\r\n  const reducerKeys = Object.keys(reducers);\r\n\r\n  const finalReducers: { [key: string]: Reducer<any, any, any> } = {};\r\n\r\n  for (let i = 0; i < reducerKeys.length; i++) {\r\n    const key = reducerKeys[i];\r\n\r\n    if (process.env.NODE_ENV !== "production") {\r\n      if (typeof reducers[key] === "undefined") {\r\n        console.log(`No reducer provided for key "${key}"`);\r\n      }\r\n    }\r\n\r\n    if (typeof reducers[key] === "function") {\r\n      finalReducers[key] = reducers[key];\r\n    }\r\n  }\r\n\r\n  const finalReducerKeys = Object.keys(finalReducers);\r\n\r\n  /**\r\n   * \u6821\u9a8c\u6bcf\u4e2areducer\u8fd4\u56de\u503c\u662f\u5426\u90fd\u6709\u6548\r\n   * \u4e0d\u8981\u5904\u7406redux\u5185\u90e8\u7684 Action \u7c7b\u578b\r\n   */\r\n  let shapeAssertionError: unknown;\r\n  try {\r\n    assertReducerShape(finalReducers);\r\n  } catch (e) {\r\n    shapeAssertionError = e;\r\n  }\r\n\r\n  return function combination(\r\n    state: StateFromReducersMapObject<typeof reducers>,\r\n    action: Action\r\n  ) {\r\n    /**\r\n     * \u5982\u679cshapeAssertionError\u6709\u9519\u8bef\u4fe1\u606f \u76f4\u63a5\u629b\u51fa\u5f02\u5e38\r\n     */\r\n    if (shapeAssertionError) {\r\n      throw shapeAssertionError;\r\n    }\r\n\r\n    /**\r\n     * \u5224\u65adreduce\u91cc\u9762\u7684Key\u548cState\u91cc\u9762\u7684Key\u662f\u5426\u76f8\u540c\r\n     * \u4e0d\u76f8\u540c\u5219\u629b\u51fa\u5f02\u5e38\r\n     */\r\n    if (process.env.NODE_ENV !== "production") {\r\n      const warningMessage = getUnexpectedStateShapeWarningMessage(\r\n        state,\r\n        finalReducers,\r\n        action\r\n      );\r\n      if (warningMessage) {\r\n        console.warn(warningMessage);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * \u4f9d\u6b21\u6267\u884c\u5bf9\u8c61\u91cc\u9762\u6bcf\u4e2areduce\u51fd\u6570\r\n     * \u5982\u679c reduce \u51fd\u6570\u8fd4\u56de\u503c\u662f \'undefined\' \u629b\u51fa\u9519\u8bef\r\n     * \u628a\u6bcf\u4e2areduce\u6267\u884c\u7684\u7ed3\u679c\u653e\u5230\u4e00\u4e2a\u65b0\u5bf9\u8c61\u91cc\u9762 \u548c\u4e0a\u4e00\u4e2a\u7ed3\u679c\u8fdb\u884c\u6bd4\u8f83 \u5224\u8bfb\u662f\u5426\u4fee\u6539\u8fc7\r\n     * \u5982\u679c\u4fee\u6539\u8fc7\u8fd4\u56de\u65b0\u5bf9\u8c61 \u6ca1\u6709\u4fee\u6539\u8fd4\u56de\u4e0a\u4e00\u6b21\u7684\u5bf9\u8c61\r\n     */\r\n    let hasChanged = false;\r\n    const nextState: StateFromReducersMapObject<typeof reducers> = {};\r\n    for (let i = 0; i < finalReducerKeys.length; i++) {\r\n      const key = finalReducerKeys[i];\r\n      const reducer = finalReducers[key];\r\n      const previousStateForKey = state[key];\r\n      const nextStateForKey = reducer(previousStateForKey, action);\r\n      if (typeof nextStateForKey === "undefined") {\r\n        const actionType = action && action.type;\r\n        throw new Error(\r\n          `When called with an action of type ${\r\n            actionType ? `"${String(actionType)}"` : "(unknown type)"\r\n          }, the slice reducer for key "${key}" returned undefined. ` +\r\n            `To ignore an action, you must explicitly return the previous state. ` +\r\n            `If you want this reducer to hold no value, you can return null instead of undefined.`\r\n        );\r\n      }\r\n      nextState[key] = nextStateForKey;\r\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey;\r\n    }\r\n    hasChanged =\r\n      hasChanged || finalReducerKeys.length !== Object.keys(state).length;\r\n    return hasChanged ? nextState : state;\r\n  };\r\n};\r\n\r\nexport default combineReducers;\n'})})]})}function l(e={}){const{wrapper:r}={...(0,c.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8906:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>i});var t=n(6672);const s={},c=t.createContext(s);function o(e){const r=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(c.Provider,{value:r},e.children)}}}]);